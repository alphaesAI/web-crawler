# File path: scripts/mutual_fund_historical_nav.py

from mftool import Mftool
import pandas as pd

def fetch_historical_nav(scheme_code):
    """
    Fetches historical NAV data for a specific mutual fund scheme.
    Args:
        scheme_code (str): The scheme code of the mutual fund.
    Returns:
        pd.DataFrame: DataFrame containing historical NAV data.
    """
    mf = Mftool()
    try:
        historical_data = mf.get_scheme_historical_nav(scheme_code)
        if "data" not in historical_data or not historical_data["data"]:
            print(f"No historical data found for Scheme Code: {scheme_code}")
            return None
        
        # Convert historical NAV data to DataFrame
        data = historical_data["data"]
        df = pd.DataFrame(data)
        df["scheme_code"] = scheme_code  # Add scheme code for reference
        return df
    except Exception as e:
        print(f"Error fetching historical NAV for Scheme Code {scheme_code}: {e}")
        return None

def fetch_scheme_details(scheme_code):
    """
    Fetches basic details about a mutual fund scheme.
    Args:
        scheme_code (str): The scheme code of the mutual fund.
    Returns:
        dict: Dictionary containing scheme details.
    """
    mf = Mftool()
    try:
        scheme_details = mf.get_scheme_details(scheme_code)
        if not scheme_details:
            print(f"No details found for Scheme Code: {scheme_code}")
            return None
        return scheme_details
    except Exception as e:
        print(f"Error fetching scheme details for Scheme Code {scheme_code}: {e}")
        return None

def display_scheme_data():
    """
    Prompts user for a scheme code and displays its details and historical NAV data.
    """
    mf = Mftool()
    try:
        scheme_code = input("Enter the Scheme Code: ").strip()
        print(f"\nFetching details for Scheme Code: {scheme_code}...")

        # Fetch and display basic scheme details
        scheme_details = fetch_scheme_details(scheme_code)
        if scheme_details:
            print("\nBasic Scheme Details:")
            for key, value in scheme_details.items():
                print(f"{key}: {value}")

        # Fetch and display historical NAV data
        historical_nav = fetch_historical_nav(scheme_code)
        if historical_nav is not None:
            print("\nHistorical NAV Data:")
            print(historical_nav)
        else:
            print("No historical NAV data available.")
    except Exception as e:
        print(f"Error during data fetch: {e}")

if __name__ == "__main__":
    # Fetch and display data for a manually input scheme code
    display_scheme_data()
